{{!
  Copyright (C) 2016 Google Inc., authors, and contributors <see AUTHORS file>
  Licensed under http://www.apache.org/licenses/LICENSE-2.0 <see LICENSE file>
  Created By: vladan@reciprocitylabs.com
  Maintained By: vladan@reciprocitylabs.com
}}

<div class="modal-header">
  <a class="modal-dismiss pull-right" href="javascript://" data-dismiss="modal">
    <i class="fa fa-times black"></i>
  </a>
  <h2>
    Map Workflow
  </h2>
</div>
<div class="modal-filter modal-body choose-object-wrap">
  <div class="row-fluid add-button">
    <div class="span12">
      <div class="pull-right">
        <a
           class="btn btn-small btn-draft"
           href="javascript://"
           data-toggle="modal-ajax-form"
           data-modal-class="modal-wide"
           data-object-singular="{{mapper.model.singular}}"
           data-object-plural="{{mapper.model.plural}}"
           data-join-object-id="{{mapper.join_object_id}}"
        >
          <i class="fa fa-plus-circle"></i>
          Create New Workflow
        </a>
      </div>
    </div>
  </div>
  <div class="row-fluid">
    <div class="span4">
      <h6>Object type</h6>
      <select disabled class="input-block-level" can-value="mapper.type" name="type-select">
        <option data-singular="Workflow" data-plural="workflows" value="Workflow" label="Workflow"></option>
      </select>
    </div>
    <div class="span4">
      <div class="modal-search">
        <h6>Matching terms</h6>
        <div class="modal-search objective-selector">
          <input id="search" class="input-block-level" placeholder="Enter text to search..." can-value="mapper.term" type="text" autofocus>
        </div>
      </div>
    </div>
    <div class="span4">
      <h6>Filter by owner or contact</h6>
      <div class="modal-search objective-selector">
        <input
          id="search-by-owner"
          class="search-by-owner input-block-level"
          placeholder="Find owner or contact"
          type="text"
          name="contact"
          value="{{firstnonempty name email title}}"
          data-lookup="Person"
          data-template="/people/autocomplete_result.mustache"
          null-if-empty="null-if-empty"
          {{ autocomplete_select }}
        >
      </div>
    </div>
  </div>
  <div class="relevance-filters">
    <div class="row-fluid">
      <div class="span12">
        <h6>Filter by mapping relevance</h6>
        {{#each relevant}}
          <div class="single-line-filter">
            <button type="submit" data-index="{{@index}}" class="remove_filter">
              <i class="fa fa-trash"></i>
            </button>
            <label>
              {{#if @index}}AND {{/if}}Relevant to:
            </label>
            <select class="input-small filter-type-selector select-filter{{@index}}" can-value="model_name">
              {{#menu}}
                {{#if model_singular}}<option value="{{model_singular}}" label="{{title_singular}}"></option>{{/if}}
              {{/menu}}
            </select>
            {{#filter}}
              {{#if_helpers '\
                #if' model_name '\
                and ^if_equals' model_name '__previous__'}}
                {{#model_name}}
                <div class="modal-search objective-selector">
                  <input
                    class="input-large search-icon search-filter-{{@index}}"
                    placeholder="Enter text to search for {{model_name}}"
                    type="text"
                    data-index="{{@index}}"
                    name="filter_list.{{@index}}.filter"
                    value="{{firstnonempty filter.name filter.email filter.title}}"
                    data-lookup="{{this}}"
                    data-template="/{{#if_equals model_name 'Person'}}people{{else}}base_objects{{/if_equals}}/autocomplete_result.mustache"
                    {{ autocomplete_select }}
                    >
                </div>
                {{/model_name}}
              {{/if_helpers}}
            {{/filter}}
          </div>
        {{/each}}
        <div class="add-rule">
          <a href="javascript://" can-click="addFilter" class="add-filter-rule">+ Add New Rule</a>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="filter-actions wrap-modal-spacing">
  <div class="row-fluid">
    <div class="span12">
      <a class="btn btn-small btn-info pull-right modalSearchButton {{#loading_or_saving}}disabled{{/loading_or_saving}}" href="javascript://">
        Search
      </a>
    </div>
  </div>
</div>

<div class="results modal-custom-spacing">
  <div class="results-num">
    <div class="row-fluid">
      <div class="span9">
        <strong>
          5 Objects found
        </strong>
      </div>
    </div>
  </div>
  <div class="results-wrap">
    <ul class="result-tree tree-structure new-tree">
      <li class="tree-item task-item">
        <div class="item-main">
          <div class="item-wrap">
            <div class="openclose">
              <span class="status-label status-draft"></span>
              <i class="fa fa-caret-right"></i>
            </div>
            <div class="select">
              <div class="item-data">
                <div class="row-fluid">
                  <div class="span11">
                    <div class="tree-title-area">
                      Backlog (One time)
                    </div>
                  </div>
                  <div class="span1">
                    <div class="object-check" align="left">
                      <label>
                        <input type="checkbox" class="object-check-single" can-value="checkbox" checked>
                      </label>
                    </div>
                  </div>
                </div>
              </div><!-- item-data end -->
            </div><!-- select end -->
          </div><!-- item-wrap end -->
        </div><!-- item-main end -->

        <div class="tier-2-info item-content">
          <div class="tier-2-info-content">
            <lazy-openclose>
              {{#show}}
                {{#find_template 'tier2_content' instance}}
                  {{#instance.class.table_singular}}
                    {{{renderLive template}}}
                  {{/instance}}
                {{else}}
                  <div class="show-description">
                    <div class="row-fluid">
                      <div class="span12">
                        <div class="tree-description short">
                          {{{instance.description}}}
                        </div>
                        {{{show_long}}}
                      </div>
                    </div>
                  </div>
                {{/find_template}}
              {{/show}}
            </lazy-openclose>
          </div>
        </div>
      </li>
      <li class="tree-item task-item">
        <div class="item-main">
          <div class="item-wrap">
            <div class="openclose">
              <span class="status-label status-draft"></span>
              <i class="fa fa-caret-right"></i>
            </div>
            <div class="select">
              <div class="item-data">
                <div class="row-fluid">
                  <div class="span11">
                    <div class="tree-title-area">
                      Backlog (Weekly)
                    </div>
                  </div>
                  <div class="span1">
                    <div class="object-check" align="left">
                      <label>
                        <input type="checkbox" class="object-check-single" can-value="checkbox" disabled>
                      </label>
                    </div>
                  </div>
                </div>
              </div><!-- item-data end -->
            </div><!-- select end -->
          </div><!-- item-wrap end -->
        </div><!-- item-main end -->

        <div class="tier-2-info item-content">
          <div class="tier-2-info-content">
            <lazy-openclose>
              {{#show}}
                {{#find_template 'tier2_content' instance}}
                  {{#instance.class.table_singular}}
                    {{{renderLive template}}}
                  {{/instance}}
                {{else}}
                  <div class="show-description">
                    <div class="row-fluid">
                      <div class="span12">
                        <div class="tree-description short">
                          {{{instance.description}}}
                        </div>
                        {{{show_long}}}
                      </div>
                    </div>
                  </div>
                {{/find_template}}
              {{/show}}
            </lazy-openclose>
          </div>
        </div>
      </li>
      <li class="tree-item task-item">
        <div class="item-main">
          <div class="item-wrap">
            <div class="openclose">
              <span class="status-label status-draft"></span>
              <i class="fa fa-caret-right"></i>
            </div>
            <div class="select">
              <div class="item-data">
                <div class="row-fluid">
                  <div class="span11">
                    <div class="tree-title-area">
                      Backlog (Monthly)
                    </div>
                  </div>
                  <div class="span1">
                    <div class="object-check" align="left">
                      <label>
                        <input type="checkbox" class="object-check-single" can-value="checkbox" disabled>
                      </label>
                    </div>
                  </div>
                </div>
              </div><!-- item-data end -->
            </div><!-- select end -->
          </div><!-- item-wrap end -->
        </div><!-- item-main end -->

        <div class="tier-2-info item-content">
          <div class="tier-2-info-content">
            <lazy-openclose>
              {{#show}}
                {{#find_template 'tier2_content' instance}}
                  {{#instance.class.table_singular}}
                    {{{renderLive template}}}
                  {{/instance}}
                {{else}}
                  <div class="show-description">
                    <div class="row-fluid">
                      <div class="span12">
                        <div class="tree-description short">
                          {{{instance.description}}}
                        </div>
                        {{{show_long}}}
                      </div>
                    </div>
                  </div>
                {{/find_template}}
              {{/show}}
            </lazy-openclose>
          </div>
        </div>
      </li>
      <li class="tree-item task-item">
        <div class="item-main">
          <div class="item-wrap">
            <div class="openclose">
              <span class="status-label status-draft"></span>
              <i class="fa fa-caret-right"></i>
            </div>
            <div class="select">
              <div class="item-data">
                <div class="row-fluid">
                  <div class="span11">
                    <div class="tree-title-area">
                      Backlog (Quarterly)
                    </div>
                  </div>
                  <div class="span1">
                    <div class="object-check" align="left">
                      <label>
                        <input type="checkbox" class="object-check-single" can-value="checkbox" disabled>
                      </label>
                    </div>
                  </div>
                </div>
              </div><!-- item-data end -->
            </div><!-- select end -->
          </div><!-- item-wrap end -->
        </div><!-- item-main end -->

        <div class="tier-2-info item-content">
          <div class="tier-2-info-content">
            <lazy-openclose>
              {{#show}}
                {{#find_template 'tier2_content' instance}}
                  {{#instance.class.table_singular}}
                    {{{renderLive template}}}
                  {{/instance}}
                {{else}}
                  <div class="show-description">
                    <div class="row-fluid">
                      <div class="span12">
                        <div class="tree-description short">
                          {{{instance.description}}}
                        </div>
                        {{{show_long}}}
                      </div>
                    </div>
                  </div>
                {{/find_template}}
              {{/show}}
            </lazy-openclose>
          </div>
        </div>
      </li>
      <li class="tree-item task-item">
        <div class="item-main">
          <div class="item-wrap">
            <div class="openclose">
              <span class="status-label status-draft"></span>
              <i class="fa fa-caret-right"></i>
            </div>
            <div class="select">
              <div class="item-data">
                <div class="row-fluid">
                  <div class="span11">
                    <div class="tree-title-area">
                      Backlog (Annually)
                    </div>
                  </div>
                  <div class="span1">
                    <div class="object-check" align="left">
                      <label>
                        <input type="checkbox" class="object-check-single" can-value="checkbox" disabled>
                      </label>
                    </div>
                  </div>
                </div>
              </div><!-- item-data end -->
            </div><!-- select end -->
          </div><!-- item-wrap end -->
        </div><!-- item-main end -->

        <div class="tier-2-info item-content">
          <div class="tier-2-info-content">
            <lazy-openclose>
              {{#show}}
                {{#find_template 'tier2_content' instance}}
                  {{#instance.class.table_singular}}
                    {{{renderLive template}}}
                  {{/instance}}
                {{else}}
                  <div class="show-description">
                    <div class="row-fluid">
                      <div class="span12">
                        <div class="tree-description short">
                          {{{instance.description}}}
                        </div>
                        {{{show_long}}}
                      </div>
                    </div>
                  </div>
                {{/find_template}}
              {{/show}}
            </lazy-openclose>
          </div>
        </div>
      </li>
    </ul>
    {{#if page_loading}}
      <div class="row-fluid clearfix">
        <span {{attach_spinner '{ "radius": 4, "length": 7, "width": 2 }'}} style="margin: 20px auto; display: block; width: 40px;"></span>
      </div>
    {{/if}}
  </div>
</div>

<div class="modal-footer">
  {{^if mapper.search_only}}
  <div class="row-fluid">
    <div class="span6">
      <div class="deny-buttons"></div>
    </div>
    <div class="span6">
      <div class="confirm-buttons">
        <a class="btn-map btn btn-small btn-success preventdoubleclick modal-dismiss workflow-frequency-trigger"
        href="javascript://">
          {{#if mapper.is_saving}}
            Saving, please wait...
          {{else}}
            {{#if template.submitButton}}
              {{template.submitButton}}
            {{else}}
              Add Selected
            {{/if}}
          {{/if}}
        </a>
      </div>
    </div>
  </div>
  {{/if}}
</div>
